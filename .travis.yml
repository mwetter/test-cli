language: python
python:
  - "2.7"

notifications:
  email: false

git:
  depth: 3

services:
  - docker

env:
  - UNITTESTS=--validate-html-only
  - UNITTESTS="-b -s Buildings.Controls"
  - UNITTESTS="-b -s Buildings.ThermalZones.Detailed.BaseClasses"
  - UNITTESTS="-b -s Buildings.ThermalZones.Detailed.Constructions"
  - UNITTESTS="-b -s Buildings.ThermalZones.Detailed.Examples.Controls"
  - UNITTESTS="-b -s Buildings.ThermalZones.Detailed.Examples.FFD"
  - UNITTESTS="-b -s Buildings.ThermalZones.Detailed.FLEXLAB"
  - UNITTESTS="-b -s Buildings.ThermalZones.Detailed.Validation.BESTEST"
  - UNITTESTS="-b -s Buildings.ThermalZones.Detailed.Validation.LBNL_71T"
  - UNITTESTS="-b -s Buildings.ThermalZones.Detailed.Validation.TestConditionalConstructions"
  - UNITTESTS="-b -s Buildings.Examples.ChillerPlant"
  - UNITTESTS="-b -s Buildings.Examples.DualFanDualDuct"
  - UNITTESTS="-b -s Buildings.Examples.HydronicHeating"
  - UNITTESTS="-b -s Buildings.Examples.Tutorial"
  - UNITTESTS="-b -s Buildings.Examples.VAVCO2"
  - UNITTESTS="-b -s Buildings.Examples.VAVReheat"

# Enable system site packages in virtualenv so BuildingsPy sees scipy and matplotlib
virtualenv:
  system_site_packages: true

before_install:
  - sudo apt-get install -qq python-numpy python-scipy python-matplotlib
  - docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD";
  - docker pull "$DOCKER_USERNAME"/travis_ubuntu-1604_dymola-2017fd01-x86-64

# Install dependencies     - echo "ls -lh \"\$@\"" >> dymola
install:
#  - sudo apt-get install -q python-tidylib
  - pip install git+https://github.com/lbl-srg/BuildingsPy@test-cli
  - sudo mv Buildings/Resources/Scripts/travis/usr/local/bin/dymola /usr/local/bin/

# Execute tests
script:
  - (cd Buildings && travis_wait 3600 python ../bin/runUnitTests.py $UNITTESTS)

after_failure:
  - cat Buildings/simulator.log
